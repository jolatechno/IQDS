\hypertarget{quids_8hpp_source}{}\doxysection{quids.\+hpp}
\label{quids_8hpp_source}\index{/home/joseph/Documents/projets/programing/cpp/Quantum-\/graph-\/simulation/src/QuIDS/src/quids.hpp@{/home/joseph/Documents/projets/programing/cpp/Quantum-\/graph-\/simulation/src/QuIDS/src/quids.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <parallel/algorithm>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <parallel/numeric>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <limits>}}
\DoxyCodeLine{6 }
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <complex>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <cstddef>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}utils/libs/robin\_hood.h"{}}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}utils/vector.hpp"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}utils/load\_balancing.hpp"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}utils/algorithm.hpp"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}utils/memory.hpp"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}utils/random.hpp"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#ifndef PROBA\_TYPE}}
\DoxyCodeLine{20 \textcolor{preprocessor}{    \#define PROBA\_TYPE double }}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#ifndef HASH\_MAP\_OVERHEAD}}
\DoxyCodeLine{23 \textcolor{preprocessor}{    \#define HASH\_MAP\_OVERHEAD 1.7 }}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#ifndef TOLERANCE}}
\DoxyCodeLine{26 \textcolor{preprocessor}{    \#define TOLERANCE 1e-\/100;}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#ifndef SAFETY\_MARGIN}}
\DoxyCodeLine{29 \textcolor{preprocessor}{    \#define SAFETY\_MARGIN 0.2}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#ifndef LOAD\_BALANCING\_BUCKET\_PER\_THREAD}}
\DoxyCodeLine{32 \textcolor{preprocessor}{    \#define LOAD\_BALANCING\_BUCKET\_PER\_THREAD 32}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{comment}{/*}}
\DoxyCodeLine{36 \textcolor{comment}{defining openmp function's return values if openmp isn't installed or loaded}}
\DoxyCodeLine{37 \textcolor{comment}{*/} }
\DoxyCodeLine{38 \textcolor{preprocessor}{\#ifndef \_OPENMP}}
\DoxyCodeLine{39 \textcolor{preprocessor}{    \#define omp\_set\_nested(i)}}
\DoxyCodeLine{40 \textcolor{preprocessor}{    \#define omp\_get\_thread\_num() 0}}
\DoxyCodeLine{41 \textcolor{preprocessor}{    \#define omp\_get\_num\_threads() 1}}
\DoxyCodeLine{42 \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{43 \textcolor{preprocessor}{    \#include <omp.h>}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{45 }
\DoxyCodeLine{47 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacequids}{quids}} \{}
\DoxyCodeLine{49     PROBA\_TYPE \mbox{\hyperlink{namespacequids_ae6148553f287fa7c670cc8d0a729fe8d}{tolerance}} = TOLERANCE;}
\DoxyCodeLine{51     \textcolor{keywordtype}{float} \mbox{\hyperlink{namespacequids_acf286be928cefbb5ad9e672e1999de1b}{safety\_margin}} = SAFETY\_MARGIN;}
\DoxyCodeLine{53     \textcolor{keywordtype}{int} \mbox{\hyperlink{namespacequids_a967bbc4ed348a75e24789554a64f8d62}{load\_balancing\_bucket\_per\_thread}} = LOAD\_BALANCING\_BUCKET\_PER\_THREAD;}
\DoxyCodeLine{54 \textcolor{preprocessor}{    \#ifdef SIMPLE\_TRUNCATION}}
\DoxyCodeLine{56         \textcolor{keywordtype}{bool} \mbox{\hyperlink{namespacequids_af08ec7fda63cfb6d458ad3bb10b31e4d}{simple\_truncation}} = \textcolor{keyword}{true};}
\DoxyCodeLine{57 \textcolor{preprocessor}{    \#else}}
\DoxyCodeLine{59         \textcolor{keywordtype}{bool} \mbox{\hyperlink{namespacequids_af08ec7fda63cfb6d458ad3bb10b31e4d}{simple\_truncation}} = \textcolor{keyword}{false};}
\DoxyCodeLine{60 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{61 }
\DoxyCodeLine{63     \textcolor{keyword}{typedef} std::complex<PROBA\_TYPE> \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}};}
\DoxyCodeLine{65     \textcolor{keyword}{typedef} \textcolor{keyword}{class }\mbox{\hyperlink{classquids_1_1iteration}{iteration}} \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}};}
\DoxyCodeLine{67     \textcolor{keyword}{typedef} \textcolor{keyword}{class }\mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}} \mbox{\hyperlink{namespacequids_a2f3cfcb2f4d55d58993493426aafb2fe}{sy\_it\_t}};}
\DoxyCodeLine{69     \textcolor{keyword}{typedef} \textcolor{keyword}{class }\mbox{\hyperlink{classquids_1_1rule}{rule}} \mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}};}
\DoxyCodeLine{71     \textcolor{keyword}{typedef} std::function<void(\textcolor{keywordtype}{char}* parent\_begin, \textcolor{keywordtype}{char}* parent\_end, \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}} \&mag)> \mbox{\hyperlink{namespacequids_afeaf790d80dab43e9208b19dd4a38677}{modifier\_t}};}
\DoxyCodeLine{73     \textcolor{keyword}{typedef} std::function<PROBA\_TYPE(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *object\_begin, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *object\_end)> \mbox{\hyperlink{namespacequids_ab614af3adb7a49a771409f0d8c81b081}{observable\_t}};}
\DoxyCodeLine{75     \textcolor{keyword}{typedef} std::function<void(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* step)> \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}};}
\DoxyCodeLine{76 }
\DoxyCodeLine{78     \textcolor{keyword}{class }\mbox{\hyperlink{classquids_1_1rule}{rule}} \{}
\DoxyCodeLine{79     \textcolor{keyword}{public}:}
\DoxyCodeLine{81         \mbox{\hyperlink{classquids_1_1rule_ab5963493c6aa55d4893460fd92a97c1c}{rule}}() \{\};}
\DoxyCodeLine{83 }
\DoxyCodeLine{88         \textcolor{keyword}{virtual} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1rule_a429e7c84be9a63d731202588c139c5c4}{get\_num\_child}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *parent\_begin, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *parent\_end, \textcolor{keywordtype}{size\_t} \&num\_child, \textcolor{keywordtype}{size\_t} \&max\_child\_size) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{90 }
\DoxyCodeLine{97         \textcolor{keyword}{virtual} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1rule_a74036f747c41880a69008a747e287654}{populate\_child}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *parent\_begin, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *parent\_end, \textcolor{keywordtype}{char}* \textcolor{keyword}{const} child\_begin, uint32\_t \textcolor{keyword}{const} child\_id, \textcolor{keywordtype}{size\_t} \&size, \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}} \&mag) \textcolor{keyword}{const} = 0;}
\DoxyCodeLine{99 }
\DoxyCodeLine{104         \textcolor{keyword}{virtual} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1rule_aedbe9927c37b7a6915168c5ed756cdbb}{populate\_child\_simple}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *parent\_begin, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *parent\_end, \textcolor{keywordtype}{char}* \textcolor{keyword}{const} child\_begin, uint32\_t \textcolor{keyword}{const} child\_id)\textcolor{keyword}{ const }\{ \textcolor{comment}{//can be overwritten}}
\DoxyCodeLine{105             \textcolor{keywordtype}{size\_t} size\_placeholder;}
\DoxyCodeLine{106             \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}} mag\_placeholder;}
\DoxyCodeLine{107             \mbox{\hyperlink{classquids_1_1rule_a74036f747c41880a69008a747e287654}{populate\_child}}(parent\_begin, parent\_end, child\_begin, child\_id,}
\DoxyCodeLine{108                 size\_placeholder, mag\_placeholder);}
\DoxyCodeLine{109         \}}
\DoxyCodeLine{111 }
\DoxyCodeLine{116         \textcolor{keyword}{virtual} \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classquids_1_1rule_ad882b931d148eb4dbd44961244d259d1}{hasher}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *object\_begin, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *object\_end)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{117             \textcolor{keywordflow}{return} std::hash<std::string\_view>()(std::string\_view(object\_begin, std::distance(object\_begin, object\_end)));}
\DoxyCodeLine{118         \}}
\DoxyCodeLine{119     \};}
\DoxyCodeLine{120 }
\DoxyCodeLine{122     \textcolor{keyword}{class }\mbox{\hyperlink{classquids_1_1iteration}{iteration}} \{}
\DoxyCodeLine{123     \textcolor{keyword}{public}:}
\DoxyCodeLine{125         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} = 0;}
\DoxyCodeLine{127         PROBA\_TYPE \mbox{\hyperlink{classquids_1_1iteration_ad330de0af20f855358d13da0cf55d014}{total\_proba}} = 1;}
\DoxyCodeLine{128 }
\DoxyCodeLine{130         \mbox{\hyperlink{classquids_1_1iteration_a6de334c02239ad957b629308bb3b84e9}{iteration}}() \{}
\DoxyCodeLine{131             resize(0);}
\DoxyCodeLine{132             allocate(0);}
\DoxyCodeLine{133             object\_begin[0] = 0;}
\DoxyCodeLine{134         \}}
\DoxyCodeLine{136 }
\DoxyCodeLine{139         \mbox{\hyperlink{classquids_1_1iteration_a4785eab38b255aaa1c4569ab9570245a}{iteration}}(\textcolor{keywordtype}{char}* object\_begin\_, \textcolor{keywordtype}{char}* object\_end\_) : \mbox{\hyperlink{classquids_1_1iteration}{iteration}}() \{}
\DoxyCodeLine{140             \mbox{\hyperlink{classquids_1_1iteration_aab0ca529d3c1689ad8d4e777acf83cb1}{append}}(object\_begin\_, object\_end\_);}
\DoxyCodeLine{141         \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{147         \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1iteration_aab0ca529d3c1689ad8d4e777acf83cb1}{append}}(\textcolor{keywordtype}{char} \textcolor{keyword}{const} *object\_begin\_, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *object\_end\_, \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}} \textcolor{keyword}{const} mag=1) \{}
\DoxyCodeLine{148             \textcolor{keywordtype}{size\_t} offset = object\_begin[\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}];}
\DoxyCodeLine{149             \textcolor{keywordtype}{size\_t} size = std::distance(object\_begin\_, object\_end\_);}
\DoxyCodeLine{150 }
\DoxyCodeLine{151             resize(++\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}});}
\DoxyCodeLine{152             allocate(offset + size);}
\DoxyCodeLine{153 }
\DoxyCodeLine{154             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < size; ++i)}
\DoxyCodeLine{155                 objects[offset + i] = object\_begin\_[i];}
\DoxyCodeLine{156 }
\DoxyCodeLine{157             magnitude[\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} -\/ 1] = mag;}
\DoxyCodeLine{158             object\_begin[\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}] = offset + size;}
\DoxyCodeLine{159         \}}
\DoxyCodeLine{161 }
\DoxyCodeLine{165         \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1iteration_a7d940691bcce7bd1d14b32cbb0a91ffe}{pop}}(\textcolor{keywordtype}{size\_t} n=1, \textcolor{keywordtype}{bool} normalize\_=\textcolor{keyword}{true}) \{}
\DoxyCodeLine{166             \textcolor{keywordflow}{if} (n < 1)}
\DoxyCodeLine{167                 \textcolor{keywordflow}{return};}
\DoxyCodeLine{168 }
\DoxyCodeLine{169             \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} -\/= n;}
\DoxyCodeLine{170             allocate(object\_begin[\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}]);}
\DoxyCodeLine{171             resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}});}
\DoxyCodeLine{172 }
\DoxyCodeLine{173             \textcolor{keywordflow}{if} (normalize\_) normalize();}
\DoxyCodeLine{174         \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{179         PROBA\_TYPE \mbox{\hyperlink{classquids_1_1iteration_a605ea87c36fba513f9ced985a56a14f0}{average\_value}}(\textcolor{keyword}{const} \mbox{\hyperlink{namespacequids_ab614af3adb7a49a771409f0d8c81b081}{observable\_t}} observable)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{180             PROBA\_TYPE avg = 0;}
\DoxyCodeLine{181             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} == 0)}
\DoxyCodeLine{182                 \textcolor{keywordflow}{return} avg;}
\DoxyCodeLine{183 }
\DoxyCodeLine{184 \textcolor{preprocessor}{            \#pragma omp parallel}}
\DoxyCodeLine{185             \{   }
\DoxyCodeLine{186                 \textcolor{comment}{/* compute average per thread */}}
\DoxyCodeLine{187                 PROBA\_TYPE local\_avg = 0;}
\DoxyCodeLine{188 \textcolor{preprocessor}{                \#pragma omp for }}
\DoxyCodeLine{189                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}; ++oid) \{}
\DoxyCodeLine{190                     \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{191                     std::complex<PROBA\_TYPE> mag;}
\DoxyCodeLine{192 }
\DoxyCodeLine{193                     \textcolor{comment}{/* get object and accumulate */}}
\DoxyCodeLine{194                     \textcolor{keywordtype}{char} \textcolor{keyword}{const} *this\_object\_begin;}
\DoxyCodeLine{195                     \mbox{\hyperlink{classquids_1_1iteration_adfe526924b30b26d1c363e751c5dced0}{get\_object}}(oid, this\_object\_begin, size, mag);}
\DoxyCodeLine{196                     local\_avg += observable(this\_object\_begin, this\_object\_begin + size) * std::norm(mag);}
\DoxyCodeLine{197                 \}}
\DoxyCodeLine{198 }
\DoxyCodeLine{199                 \textcolor{comment}{/* accumulate thread averages */}}
\DoxyCodeLine{200 \textcolor{preprocessor}{                \#pragma omp critical}}
\DoxyCodeLine{201                 avg += local\_avg;}
\DoxyCodeLine{202             \}}
\DoxyCodeLine{203 }
\DoxyCodeLine{204             \textcolor{keywordflow}{return} avg;}
\DoxyCodeLine{205         \}}
\DoxyCodeLine{207 }
\DoxyCodeLine{213         \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1iteration_adfe526924b30b26d1c363e751c5dced0}{get\_object}}(\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} object\_id, \textcolor{keywordtype}{char} *\& object\_begin\_, \textcolor{keywordtype}{size\_t} \&object\_size, \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}} *\&mag) \{}
\DoxyCodeLine{214             \textcolor{keywordtype}{size\_t} this\_object\_begin = object\_begin[object\_id];}
\DoxyCodeLine{215             object\_size = object\_begin[object\_id + 1] -\/ this\_object\_begin;}
\DoxyCodeLine{216             mag = \&magnitude[object\_id];}
\DoxyCodeLine{217             object\_begin\_ = \&objects[this\_object\_begin];}
\DoxyCodeLine{218         \}}
\DoxyCodeLine{220 }
\DoxyCodeLine{226         \textcolor{keywordtype}{void} \mbox{\hyperlink{classquids_1_1iteration_af6ca4962c658bb77b5841f316711c7e1}{get\_object}}(\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} object\_id, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *\& object\_begin\_, \textcolor{keywordtype}{size\_t} \&object\_size, \mbox{\hyperlink{namespacequids_a13a066a7f98435d1c84f2318439d4f0b}{mag\_t}} \&mag)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{227             \textcolor{keywordtype}{size\_t} this\_object\_begin = object\_begin[object\_id];}
\DoxyCodeLine{228             object\_size = object\_begin[object\_id + 1] -\/ this\_object\_begin;}
\DoxyCodeLine{229             mag = magnitude[object\_id];}
\DoxyCodeLine{230             object\_begin\_ = \&objects[this\_object\_begin];}
\DoxyCodeLine{231         \}}
\DoxyCodeLine{232 }
\DoxyCodeLine{233     \textcolor{keyword}{private}:}
\DoxyCodeLine{234         \textcolor{keyword}{friend} \mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}};}
\DoxyCodeLine{235         \textcolor{keyword}{friend} \textcolor{keywordtype}{void} \textcolor{keyword}{inline} \mbox{\hyperlink{classquids_1_1iteration_a09d4f5a2ab584cbdd6374a78cad50ec0}{simulate}}(\mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&\mbox{\hyperlink{classquids_1_1iteration}{iteration}}, \mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *\mbox{\hyperlink{classquids_1_1rule}{rule}}, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&next\_iteration, \mbox{\hyperlink{namespacequids_a2f3cfcb2f4d55d58993493426aafb2fe}{sy\_it\_t}} \&\mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}}, \textcolor{keywordtype}{size\_t} max\_num\_object, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function);  }
\DoxyCodeLine{236         \textcolor{keyword}{friend} \textcolor{keywordtype}{void} \textcolor{keyword}{inline} \mbox{\hyperlink{classquids_1_1iteration_a09d4f5a2ab584cbdd6374a78cad50ec0}{simulate}}(\mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&\mbox{\hyperlink{classquids_1_1iteration}{iteration}}, \mbox{\hyperlink{namespacequids_afeaf790d80dab43e9208b19dd4a38677}{modifier\_t}} \textcolor{keyword}{const} \mbox{\hyperlink{classquids_1_1rule}{rule}});}
\DoxyCodeLine{237 }
\DoxyCodeLine{238     \textcolor{keyword}{protected}:}
\DoxyCodeLine{239         \textcolor{keyword}{mutable} \textcolor{keywordtype}{size\_t} truncated\_num\_object = 0;}
\DoxyCodeLine{240         \textcolor{keyword}{mutable} \textcolor{keywordtype}{size\_t} max\_symbolic\_object\_size = 0;}
\DoxyCodeLine{241 }
\DoxyCodeLine{242         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<mag\_t>}} magnitude;}
\DoxyCodeLine{243         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<char>}} objects;}
\DoxyCodeLine{244         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} object\_begin;}
\DoxyCodeLine{245         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} num\_childs;}
\DoxyCodeLine{246         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} child\_begin;}
\DoxyCodeLine{247         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} truncated\_oid;}
\DoxyCodeLine{248         \textcolor{keyword}{mutable} \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<float>}} random\_selector;}
\DoxyCodeLine{249 }
\DoxyCodeLine{251         \textcolor{keywordtype}{void} \textcolor{keyword}{inline} resize(\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}})\textcolor{keyword}{ const }\{}
\DoxyCodeLine{252 \textcolor{preprocessor}{            \#pragma omp parallel sections}}
\DoxyCodeLine{253             \{}
\DoxyCodeLine{254 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{255                 magnitude.resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}});}
\DoxyCodeLine{256 }
\DoxyCodeLine{257 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{258                 num\_childs.resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}});}
\DoxyCodeLine{259 }
\DoxyCodeLine{260 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{261                 object\_begin.resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} + 1);}
\DoxyCodeLine{262 }
\DoxyCodeLine{263 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{264                 child\_begin.resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} + 1);}
\DoxyCodeLine{265 }
\DoxyCodeLine{266 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{267                 \{}
\DoxyCodeLine{268                     truncated\_oid.resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}});}
\DoxyCodeLine{269                     utils::parallel\_iota(\&truncated\_oid[0], \&truncated\_oid[0] + \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}, 0);}
\DoxyCodeLine{270                 \}}
\DoxyCodeLine{271 }
\DoxyCodeLine{272 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{273                 random\_selector.resize(\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}});}
\DoxyCodeLine{274             \}}
\DoxyCodeLine{275         \}}
\DoxyCodeLine{276         \textcolor{keywordtype}{void} \textcolor{keyword}{inline} allocate(\textcolor{keywordtype}{size\_t} size)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{277             objects.resize(size);}
\DoxyCodeLine{278         \}}
\DoxyCodeLine{279 }
\DoxyCodeLine{280 }
\DoxyCodeLine{281         \textcolor{comment}{/*}}
\DoxyCodeLine{282 \textcolor{comment}{        utils functions}}
\DoxyCodeLine{283 \textcolor{comment}{        */}}
\DoxyCodeLine{284         \textcolor{keywordtype}{size\_t} get\_mem\_size()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{285             \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} iteration\_memory\_size = 2*\textcolor{keyword}{sizeof}(PROBA\_TYPE) + 4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}) + \textcolor{keyword}{sizeof}(float);}
\DoxyCodeLine{286             \textcolor{keywordflow}{return} magnitude.size()*iteration\_memory\_size + objects.size();}
\DoxyCodeLine{287         \}}
\DoxyCodeLine{288         \textcolor{keywordtype}{size\_t} get\_object\_length()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{289             \textcolor{keywordflow}{return} object\_begin[\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}];}
\DoxyCodeLine{290         \}}
\DoxyCodeLine{291         \textcolor{keywordtype}{size\_t} get\_num\_symbolic\_object()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{292             \textcolor{keywordflow}{return} \_\_gnu\_parallel::accumulate(\&num\_childs[0], \&num\_childs[0] + \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}, (\textcolor{keywordtype}{size\_t})0);}
\DoxyCodeLine{293         \}}
\DoxyCodeLine{294 }
\DoxyCodeLine{295 }
\DoxyCodeLine{296         \textcolor{keywordtype}{void} compute\_num\_child(\mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *rule, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\}) \textcolor{keyword}{const};}
\DoxyCodeLine{297         \textcolor{keywordtype}{void} prepare\_truncate(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\}) \textcolor{keyword}{const};}
\DoxyCodeLine{298         \textcolor{keywordtype}{size\_t} get\_truncated\_mem\_size(\textcolor{keywordtype}{size\_t} begin\_num\_object=0) \textcolor{keyword}{const};}
\DoxyCodeLine{299         \textcolor{keywordtype}{void} truncate(\textcolor{keywordtype}{size\_t} begin\_num\_object, \textcolor{keywordtype}{size\_t} max\_num\_object, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\}) \textcolor{keyword}{const};}
\DoxyCodeLine{300         \textcolor{keywordtype}{void} generate\_symbolic\_iteration(\mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *rule, \mbox{\hyperlink{namespacequids_a2f3cfcb2f4d55d58993493426aafb2fe}{sy\_it\_t}} \&symbolic\_iteration, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\}) \textcolor{keyword}{const};}
\DoxyCodeLine{301         \textcolor{keywordtype}{void} apply\_modifier(\mbox{\hyperlink{namespacequids_afeaf790d80dab43e9208b19dd4a38677}{modifier\_t}} \textcolor{keyword}{const} rule);}
\DoxyCodeLine{302         \textcolor{keywordtype}{void} normalize(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\});}
\DoxyCodeLine{304     \};}
\DoxyCodeLine{305 }
\DoxyCodeLine{307     \textcolor{keyword}{class }\mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}} \{}
\DoxyCodeLine{308     \textcolor{keyword}{public}:}
\DoxyCodeLine{310         \mbox{\hyperlink{classquids_1_1symbolic__iteration_a5523845c09534d44e9a357e9d2e3a0a8}{symbolic\_iteration}}() \{\}}
\DoxyCodeLine{311         }
\DoxyCodeLine{313         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}} = 0;}
\DoxyCodeLine{315         \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classquids_1_1symbolic__iteration_a54dda8c91c4bf8f7a097910ff4fbe34b}{num\_object\_after\_interferences}} = 0;}
\DoxyCodeLine{316 }
\DoxyCodeLine{317     \textcolor{keyword}{private}:}
\DoxyCodeLine{318         \textcolor{keyword}{friend} \mbox{\hyperlink{classquids_1_1iteration}{iteration}};}
\DoxyCodeLine{319         \textcolor{keyword}{friend} \textcolor{keywordtype}{void} \textcolor{keyword}{inline} \mbox{\hyperlink{classquids_1_1symbolic__iteration_a09d4f5a2ab584cbdd6374a78cad50ec0}{simulate}}(\mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&\mbox{\hyperlink{classquids_1_1iteration}{iteration}}, \mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *\mbox{\hyperlink{classquids_1_1rule}{rule}}, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&next\_iteration, \mbox{\hyperlink{namespacequids_a2f3cfcb2f4d55d58993493426aafb2fe}{sy\_it\_t}} \&\mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}}, \textcolor{keywordtype}{size\_t} max\_num\_object, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function); }
\DoxyCodeLine{320 }
\DoxyCodeLine{321     \textcolor{keyword}{protected}:}
\DoxyCodeLine{322         \textcolor{keywordtype}{size\_t} next\_iteration\_num\_object = 0;}
\DoxyCodeLine{323 }
\DoxyCodeLine{324         std::vector<char*> placeholder;}
\DoxyCodeLine{325 }
\DoxyCodeLine{326         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<mag\_t>}} magnitude;}
\DoxyCodeLine{327         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} next\_oid;}
\DoxyCodeLine{328         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector}}<\textcolor{keywordtype}{char} \textcolor{comment}{/*bool*/}> is\_unique;}
\DoxyCodeLine{329         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} size;}
\DoxyCodeLine{330         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} hash;}
\DoxyCodeLine{331         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} parent\_oid;}
\DoxyCodeLine{332         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<uint32\_t>}} child\_id;}
\DoxyCodeLine{333         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<float>}} random\_selector;}
\DoxyCodeLine{334         \mbox{\hyperlink{classquids_1_1utils_1_1fast__vector}{utils::fast\_vector<size\_t>}} next\_oid\_partitioner\_buffer;}
\DoxyCodeLine{335 }
\DoxyCodeLine{337         \textcolor{keywordtype}{void} \textcolor{keyword}{inline} resize(\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}}) \{}
\DoxyCodeLine{338 \textcolor{preprocessor}{            \#pragma omp parallel sections}}
\DoxyCodeLine{339             \{}
\DoxyCodeLine{340 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{341                 magnitude.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{342 }
\DoxyCodeLine{343 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{344                 next\_oid.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{345 }
\DoxyCodeLine{346 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{347                 is\_unique.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{348 }
\DoxyCodeLine{349 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{350                 size.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{351 }
\DoxyCodeLine{352 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{353                 hash.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{354 }
\DoxyCodeLine{355 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{356                 parent\_oid.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{357 }
\DoxyCodeLine{358 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{359                 child\_id.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{360 }
\DoxyCodeLine{361 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{362                 random\_selector.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{363 }
\DoxyCodeLine{364 \textcolor{preprocessor}{                \#pragma omp section}}
\DoxyCodeLine{365                 next\_oid\_partitioner\_buffer.resize(\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}});}
\DoxyCodeLine{366             \}}
\DoxyCodeLine{367 }
\DoxyCodeLine{368             utils::parallel\_iota(\&next\_oid[0], \&next\_oid[\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}}], 0);}
\DoxyCodeLine{369         \}}
\DoxyCodeLine{370         \textcolor{keywordtype}{void} \textcolor{keyword}{inline} reserve(\textcolor{keywordtype}{size\_t} max\_size) \{}
\DoxyCodeLine{371             \textcolor{keywordtype}{int} num\_threads;}
\DoxyCodeLine{372 \textcolor{preprocessor}{            \#pragma omp parallel}}
\DoxyCodeLine{373 \textcolor{preprocessor}{            \#pragma omp single}}
\DoxyCodeLine{374             num\_threads = omp\_get\_num\_threads();}
\DoxyCodeLine{375 }
\DoxyCodeLine{376             placeholder.resize(num\_threads);}
\DoxyCodeLine{377 }
\DoxyCodeLine{378 \textcolor{preprocessor}{            \#pragma omp parallel}}
\DoxyCodeLine{379             \{}
\DoxyCodeLine{380                 \textcolor{keyword}{auto} \&buffer = placeholder[omp\_get\_thread\_num()];}
\DoxyCodeLine{381                 \textcolor{keywordflow}{if} (buffer == NULL)}
\DoxyCodeLine{382                     free(buffer);}
\DoxyCodeLine{383                 buffer = \textcolor{keyword}{new} \textcolor{keywordtype}{char}[max\_size];}
\DoxyCodeLine{384             \}}
\DoxyCodeLine{385         \}}
\DoxyCodeLine{386 }
\DoxyCodeLine{387 }
\DoxyCodeLine{388         \textcolor{comment}{/*}}
\DoxyCodeLine{389 \textcolor{comment}{        utils functions}}
\DoxyCodeLine{390 \textcolor{comment}{        */}}
\DoxyCodeLine{391         \textcolor{keywordtype}{size\_t} get\_mem\_size()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{392             \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} symbolic\_iteration\_memory\_size = 1 + 2*\textcolor{keyword}{sizeof}(PROBA\_TYPE) + 5*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}) + \textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float});}
\DoxyCodeLine{393             \textcolor{keywordflow}{return} magnitude.size()*symbolic\_iteration\_memory\_size;}
\DoxyCodeLine{394         \}}
\DoxyCodeLine{395 }
\DoxyCodeLine{396         \textcolor{keywordtype}{void} compute\_collisions(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\});}
\DoxyCodeLine{397         \textcolor{keywordtype}{size\_t} get\_truncated\_mem\_size(\textcolor{keywordtype}{size\_t} begin\_num\_object=0) \textcolor{keyword}{const};}
\DoxyCodeLine{398         \textcolor{keywordtype}{void} truncate(\textcolor{keywordtype}{size\_t} begin\_num\_object, \textcolor{keywordtype}{size\_t} max\_num\_object, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\});}
\DoxyCodeLine{399         \textcolor{keywordtype}{void} prepare\_truncate(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\});}
\DoxyCodeLine{400         \textcolor{keywordtype}{void} finalize(\mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *rule, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \textcolor{keyword}{const} \&last\_iteration, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&next\_iteration, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\});}
\DoxyCodeLine{402     \};}
\DoxyCodeLine{403 }
\DoxyCodeLine{405 }
\DoxyCodeLine{409     \textcolor{keywordtype}{void} \textcolor{keyword}{inline} \mbox{\hyperlink{namespacequids_a0cd589223d6f94d98d0d52849bfcd76a}{simulate}}(\mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&\mbox{\hyperlink{classquids_1_1iteration}{iteration}}, \mbox{\hyperlink{namespacequids_afeaf790d80dab43e9208b19dd4a38677}{modifier\_t}} \textcolor{keyword}{const} \mbox{\hyperlink{classquids_1_1rule}{rule}}) \{}
\DoxyCodeLine{410         \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.apply\_modifier(\mbox{\hyperlink{classquids_1_1rule}{rule}});}
\DoxyCodeLine{411     \}}
\DoxyCodeLine{413 }
\DoxyCodeLine{421     \textcolor{keywordtype}{void} \textcolor{keyword}{inline} \mbox{\hyperlink{namespacequids_a0cd589223d6f94d98d0d52849bfcd76a}{simulate}}(\mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&\mbox{\hyperlink{classquids_1_1iteration}{iteration}}, \mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *\mbox{\hyperlink{classquids_1_1rule}{rule}}, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&next\_iteration, \mbox{\hyperlink{namespacequids_a2f3cfcb2f4d55d58993493426aafb2fe}{sy\_it\_t}} \&\mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}}, \textcolor{keywordtype}{size\_t} max\_num\_object=0, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function=[](\textcolor{keyword}{const} \textcolor{keywordtype}{char}*)\{\}) \{ }
\DoxyCodeLine{422         \textcolor{comment}{/* compute the number of child */}}
\DoxyCodeLine{423         \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.compute\_num\_child(\mbox{\hyperlink{classquids_1_1rule}{rule}}, mid\_step\_function);}
\DoxyCodeLine{424         \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.truncated\_num\_object = \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}};}
\DoxyCodeLine{425 }
\DoxyCodeLine{426         \textcolor{comment}{/* prepare truncate */}}
\DoxyCodeLine{427         mid\_step\_function(\textcolor{stringliteral}{"{}truncate\_symbolic -\/ prepare"{}});}
\DoxyCodeLine{428         \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.prepare\_truncate(mid\_step\_function);}
\DoxyCodeLine{429 }
\DoxyCodeLine{430         \textcolor{comment}{/* max\_num\_object */}}
\DoxyCodeLine{431         mid\_step\_function(\textcolor{stringliteral}{"{}truncate\_symbolic"{}});}
\DoxyCodeLine{432         \textcolor{keywordflow}{if} (max\_num\_object == 0) \{}
\DoxyCodeLine{433 }
\DoxyCodeLine{434             \textcolor{comment}{/* available memory */}}
\DoxyCodeLine{435             \textcolor{keywordtype}{size\_t} avail\_memory =  next\_iteration.get\_mem\_size() + \mbox{\hyperlink{classquids_1_1symbolic__iteration}{symbolic\_iteration}}.get\_mem\_size() + \mbox{\hyperlink{namespacequids_1_1utils_a594be390cd1aec6c1c991ee8242917b6}{utils::get\_free\_mem}}();}
\DoxyCodeLine{436             \textcolor{keywordtype}{size\_t} target\_memory = avail\_memory*(1 -\/ \mbox{\hyperlink{namespacequids_acf286be928cefbb5ad9e672e1999de1b}{safety\_margin}});}
\DoxyCodeLine{437 }
\DoxyCodeLine{438             \textcolor{comment}{/* actually truncate by binary search */}}
\DoxyCodeLine{439             \textcolor{keywordflow}{if} (\mbox{\hyperlink{classquids_1_1iteration}{iteration}}.get\_truncated\_mem\_size() > target\_memory) \{}
\DoxyCodeLine{440                 \textcolor{keywordtype}{size\_t} begin = 0, end = \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}};}
\DoxyCodeLine{441                 \textcolor{keywordflow}{while} (end > begin + 1) \{}
\DoxyCodeLine{442                     \textcolor{keywordtype}{size\_t} middle = (end + begin) / 2;}
\DoxyCodeLine{443                     \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.truncate(begin, middle, mid\_step\_function);}
\DoxyCodeLine{444 }
\DoxyCodeLine{445                     \textcolor{keywordtype}{size\_t} used\_memory = \mbox{\hyperlink{classquids_1_1iteration}{iteration}}.get\_truncated\_mem\_size(begin);}
\DoxyCodeLine{446                     \textcolor{keywordflow}{if} (used\_memory < target\_memory) \{}
\DoxyCodeLine{447                         target\_memory -\/= used\_memory;}
\DoxyCodeLine{448                         begin = middle;}
\DoxyCodeLine{449                     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{450                         end = middle;}
\DoxyCodeLine{451                 \}}
\DoxyCodeLine{452             \}}
\DoxyCodeLine{453         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{454             iteration.truncate(0, max\_num\_object, mid\_step\_function);}
\DoxyCodeLine{455 }
\DoxyCodeLine{456         \textcolor{comment}{/* downsize if needed */}}
\DoxyCodeLine{457         \textcolor{keywordflow}{if} (iteration.num\_object > 0) \{}
\DoxyCodeLine{458             \textcolor{keywordflow}{if} (iteration.truncated\_num\_object < next\_iteration.num\_object)}
\DoxyCodeLine{459                 next\_iteration.resize(iteration.truncated\_num\_object);}
\DoxyCodeLine{460             \textcolor{keywordtype}{size\_t} next\_object\_size = iteration.truncated\_num\_object*iteration.get\_object\_length()/iteration.num\_object;}
\DoxyCodeLine{461             \textcolor{keywordflow}{if} (next\_object\_size < next\_iteration.objects.size())}
\DoxyCodeLine{462                 next\_iteration.allocate(next\_object\_size);}
\DoxyCodeLine{463         \}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465         \textcolor{comment}{/* generate symbolic iteration */}}
\DoxyCodeLine{466         iteration.generate\_symbolic\_iteration(rule, symbolic\_iteration, mid\_step\_function);}
\DoxyCodeLine{467         symbolic\_iteration.compute\_collisions(mid\_step\_function);}
\DoxyCodeLine{468         symbolic\_iteration.next\_iteration\_num\_object = symbolic\_iteration.num\_object\_after\_interferences;}
\DoxyCodeLine{469 }
\DoxyCodeLine{470 }
\DoxyCodeLine{471         \textcolor{comment}{/* prepare truncate */}}
\DoxyCodeLine{472         mid\_step\_function(\textcolor{stringliteral}{"{}truncate -\/ prepare"{}});}
\DoxyCodeLine{473         symbolic\_iteration.prepare\_truncate(mid\_step\_function);}
\DoxyCodeLine{474 }
\DoxyCodeLine{475         \textcolor{comment}{/* second max\_num\_object */}}
\DoxyCodeLine{476         mid\_step\_function(\textcolor{stringliteral}{"{}truncate"{}});}
\DoxyCodeLine{477         \textcolor{keywordflow}{if} (max\_num\_object == 0) \{}
\DoxyCodeLine{478 }
\DoxyCodeLine{479             \textcolor{comment}{/* available memory */}}
\DoxyCodeLine{480             \textcolor{keywordtype}{size\_t} avail\_memory = next\_iteration.get\_mem\_size() + \mbox{\hyperlink{namespacequids_1_1utils_a594be390cd1aec6c1c991ee8242917b6}{utils::get\_free\_mem}}();}
\DoxyCodeLine{481             \textcolor{keywordtype}{size\_t} target\_memory = avail\_memory*(1 -\/ \mbox{\hyperlink{namespacequids_acf286be928cefbb5ad9e672e1999de1b}{safety\_margin}});}
\DoxyCodeLine{482 }
\DoxyCodeLine{483             \textcolor{comment}{/* actually truncate by binary search */}}
\DoxyCodeLine{484             \textcolor{keywordflow}{if} (symbolic\_iteration.get\_truncated\_mem\_size() > target\_memory) \{}
\DoxyCodeLine{485                 \textcolor{keywordtype}{size\_t} begin = 0, end = symbolic\_iteration.num\_object\_after\_interferences;}
\DoxyCodeLine{486                 \textcolor{keywordflow}{while} (end > begin + 1) \{}
\DoxyCodeLine{487                     \textcolor{keywordtype}{size\_t} middle = (end + begin) / 2;}
\DoxyCodeLine{488                     symbolic\_iteration.truncate(begin, middle, mid\_step\_function);}
\DoxyCodeLine{489 }
\DoxyCodeLine{490                     \textcolor{keywordtype}{size\_t} used\_memory = symbolic\_iteration.get\_truncated\_mem\_size(begin);}
\DoxyCodeLine{491                     \textcolor{keywordflow}{if} (used\_memory < target\_memory) \{}
\DoxyCodeLine{492                         target\_memory -\/= used\_memory;}
\DoxyCodeLine{493                         begin = middle;}
\DoxyCodeLine{494                     \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{495                         end = middle;}
\DoxyCodeLine{496                 \}}
\DoxyCodeLine{497             \}}
\DoxyCodeLine{498         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{499             symbolic\_iteration.truncate(0, max\_num\_object, mid\_step\_function);}
\DoxyCodeLine{500 }
\DoxyCodeLine{501         \textcolor{comment}{/* finish simulation */}}
\DoxyCodeLine{502         symbolic\_iteration.finalize(rule, iteration, next\_iteration, mid\_step\_function);}
\DoxyCodeLine{503         next\_iteration.normalize(mid\_step\_function);}
\DoxyCodeLine{504     \}}
\DoxyCodeLine{505 }
\DoxyCodeLine{506     \textcolor{comment}{/*}}
\DoxyCodeLine{507 \textcolor{comment}{    compute num child}}
\DoxyCodeLine{508 \textcolor{comment}{    */}}
\DoxyCodeLine{509     \textcolor{keywordtype}{void} iteration::compute\_num\_child(\mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *rule, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{510         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{511 \textcolor{comment}{        num\_child}}
\DoxyCodeLine{512 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{513         mid\_step\_function(\textcolor{stringliteral}{"{}num\_child"{}});}
\DoxyCodeLine{514 }
\DoxyCodeLine{515         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} == 0)}
\DoxyCodeLine{516             \textcolor{keywordflow}{return};}
\DoxyCodeLine{517 }
\DoxyCodeLine{518         max\_symbolic\_object\_size = 0;}
\DoxyCodeLine{519 }
\DoxyCodeLine{520 \textcolor{preprocessor}{        \#pragma omp parallel for  reduction(max:max\_symbolic\_object\_size)}}
\DoxyCodeLine{521         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}; ++oid) \{}
\DoxyCodeLine{522             \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{523             rule-\/>get\_num\_child(\&objects[object\_begin[oid]],}
\DoxyCodeLine{524                 \&objects[object\_begin[oid + 1]],}
\DoxyCodeLine{525                 num\_childs[oid], size);}
\DoxyCodeLine{526             max\_symbolic\_object\_size = std::max(max\_symbolic\_object\_size, size);}
\DoxyCodeLine{527         \}}
\DoxyCodeLine{528 }
\DoxyCodeLine{529         \_\_gnu\_parallel::partial\_sum(num\_childs.begin(), num\_childs.begin() + \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}, child\_begin.begin() + 1);}
\DoxyCodeLine{530     \}}
\DoxyCodeLine{531 }
\DoxyCodeLine{532     \textcolor{comment}{/*}}
\DoxyCodeLine{533 \textcolor{comment}{    get the truncated memory size}}
\DoxyCodeLine{534 \textcolor{comment}{    */}}
\DoxyCodeLine{535     \textcolor{keywordtype}{size\_t} iteration::get\_truncated\_mem\_size(\textcolor{keywordtype}{size\_t} begin\_num\_object)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{536         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} iteration\_memory\_size = 2*\textcolor{keyword}{sizeof}(PROBA\_TYPE) + 4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}) + \textcolor{keyword}{sizeof}(float);}
\DoxyCodeLine{537 }
\DoxyCodeLine{538         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{float} hash\_map\_size = HASH\_MAP\_OVERHEAD*2*\textcolor{keyword}{sizeof}(size\_t);}
\DoxyCodeLine{539         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} symbolic\_iteration\_memory\_size = 1 + 2*\textcolor{keyword}{sizeof}(PROBA\_TYPE) + 5*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}) + \textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float});}
\DoxyCodeLine{540 }
\DoxyCodeLine{541         \textcolor{keywordtype}{size\_t} mem\_size = iteration\_memory\_size*(truncated\_num\_object -\/ begin\_num\_object);}
\DoxyCodeLine{542         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = begin\_num\_object; i < truncated\_num\_object; ++i) \{}
\DoxyCodeLine{543             \textcolor{keywordtype}{size\_t} oid = truncated\_oid[i];}
\DoxyCodeLine{544 }
\DoxyCodeLine{545             mem\_size += object\_begin[oid + 1] -\/ object\_begin[oid];}
\DoxyCodeLine{546             mem\_size += num\_childs[oid]*(symbolic\_iteration\_memory\_size + hash\_map\_size);}
\DoxyCodeLine{547         \}}
\DoxyCodeLine{548 }
\DoxyCodeLine{549         \textcolor{keywordflow}{return} mem\_size;}
\DoxyCodeLine{550     \}}
\DoxyCodeLine{551 }
\DoxyCodeLine{552     \textcolor{comment}{/*}}
\DoxyCodeLine{553 \textcolor{comment}{    prepare pre-\/truncate}}
\DoxyCodeLine{554 \textcolor{comment}{    */}}
\DoxyCodeLine{555     \textcolor{keywordtype}{void} iteration::prepare\_truncate(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{556         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{557 \textcolor{comment}{        prepare pre\_truncate}}
\DoxyCodeLine{558 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{559 }
\DoxyCodeLine{560         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{namespacequids_af08ec7fda63cfb6d458ad3bb10b31e4d}{simple\_truncation}})}
\DoxyCodeLine{561 \textcolor{preprocessor}{            \#pragma omp parallel}}
\DoxyCodeLine{562             \{}
\DoxyCodeLine{563                 utils::random\_generator rng;}
\DoxyCodeLine{564 }
\DoxyCodeLine{565 \textcolor{preprocessor}{                \#pragma omp for}}
\DoxyCodeLine{566                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}; ++oid)}
\DoxyCodeLine{567                     random\_selector[oid] = rng() / std::norm(magnitude[oid]); \textcolor{comment}{//-\/std::log(1 -\/ rng()) / std::norm(magnitude[oid]);}}
\DoxyCodeLine{568             \}}
\DoxyCodeLine{569     \}}
\DoxyCodeLine{570 }
\DoxyCodeLine{571     \textcolor{comment}{/*}}
\DoxyCodeLine{572 \textcolor{comment}{    pre-\/truncate}}
\DoxyCodeLine{573 \textcolor{comment}{    */}}
\DoxyCodeLine{574     \textcolor{keywordtype}{void} iteration::truncate(\textcolor{keywordtype}{size\_t} begin\_num\_object, \textcolor{keywordtype}{size\_t} max\_num\_object, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{575         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{576 \textcolor{comment}{        pre\_truncate}}
\DoxyCodeLine{577 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{578 }
\DoxyCodeLine{579         \textcolor{keywordflow}{if} (max\_num\_object >= \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}) \{}
\DoxyCodeLine{580             truncated\_num\_object = \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}};}
\DoxyCodeLine{581             \textcolor{keywordflow}{return};}
\DoxyCodeLine{582         \}}
\DoxyCodeLine{583 }
\DoxyCodeLine{584         \textcolor{comment}{/* delimitations */}}
\DoxyCodeLine{585         \textcolor{keyword}{auto} begin = truncated\_oid.begin() + begin\_num\_object;}
\DoxyCodeLine{586         \textcolor{keyword}{auto} middle = truncated\_oid.begin() + max\_num\_object;}
\DoxyCodeLine{587         \textcolor{keyword}{auto} end = truncated\_oid.begin() + truncated\_num\_object;}
\DoxyCodeLine{588 }
\DoxyCodeLine{589         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacequids_af08ec7fda63cfb6d458ad3bb10b31e4d}{simple\_truncation}}) \{}
\DoxyCodeLine{590             \textcolor{comment}{/* truncation */}}
\DoxyCodeLine{591             \_\_gnu\_parallel::nth\_element(begin, middle, end,}
\DoxyCodeLine{592             [\&](\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid1, \textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid2) \{}
\DoxyCodeLine{593                 \textcolor{keywordflow}{return} std::norm(magnitude[oid1]) > std::norm(magnitude[oid2]);}
\DoxyCodeLine{594             \});}
\DoxyCodeLine{595         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{596             \textcolor{comment}{/* select graphs according to random selectors */}}
\DoxyCodeLine{597             \_\_gnu\_parallel::nth\_element(begin, middle, end,}
\DoxyCodeLine{598             [\&](\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid1, \textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid2) \{}
\DoxyCodeLine{599                 \textcolor{keywordflow}{return} random\_selector[oid1] < random\_selector[oid2];}
\DoxyCodeLine{600             \});}
\DoxyCodeLine{601 }
\DoxyCodeLine{602         truncated\_num\_object = max\_num\_object;}
\DoxyCodeLine{603     \}}
\DoxyCodeLine{604 }
\DoxyCodeLine{605     \textcolor{comment}{/*}}
\DoxyCodeLine{606 \textcolor{comment}{    generate symbolic iteration}}
\DoxyCodeLine{607 \textcolor{comment}{    */}}
\DoxyCodeLine{608     \textcolor{keywordtype}{void} iteration::generate\_symbolic\_iteration(\mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *rule, \mbox{\hyperlink{namespacequids_a2f3cfcb2f4d55d58993493426aafb2fe}{sy\_it\_t}} \&symbolic\_iteration, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{609         \textcolor{keywordflow}{if} (truncated\_num\_object == 0) \{}
\DoxyCodeLine{610             symbolic\_iteration.num\_object = 0;}
\DoxyCodeLine{611             mid\_step\_function(\textcolor{stringliteral}{"{}prepare\_index"{}});}
\DoxyCodeLine{612             mid\_step\_function(\textcolor{stringliteral}{"{}symbolic\_iteration"{}});}
\DoxyCodeLine{613             \textcolor{keywordflow}{return};}
\DoxyCodeLine{614         \}}
\DoxyCodeLine{615 }
\DoxyCodeLine{616         }
\DoxyCodeLine{617 }
\DoxyCodeLine{618 }
\DoxyCodeLine{619 }
\DoxyCodeLine{620 }
\DoxyCodeLine{621 }
\DoxyCodeLine{622         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{623 \textcolor{comment}{        prepare\_index}}
\DoxyCodeLine{624 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{625         mid\_step\_function(\textcolor{stringliteral}{"{}prepare\_index"{}});}
\DoxyCodeLine{626 }
\DoxyCodeLine{627         child\_begin[0] = 0;}
\DoxyCodeLine{628         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < truncated\_num\_object; ++i) \{}
\DoxyCodeLine{629             \textcolor{keywordtype}{size\_t} oid = truncated\_oid[i];}
\DoxyCodeLine{630 }
\DoxyCodeLine{631             child\_begin[i + 1] = child\_begin[i] + num\_childs[oid];}
\DoxyCodeLine{632         \}}
\DoxyCodeLine{633 }
\DoxyCodeLine{634         symbolic\_iteration.num\_object = child\_begin[truncated\_num\_object];}
\DoxyCodeLine{635 }
\DoxyCodeLine{636         \textcolor{comment}{/* resize symbolic iteration */}}
\DoxyCodeLine{637         symbolic\_iteration.resize(symbolic\_iteration.num\_object);}
\DoxyCodeLine{638         symbolic\_iteration.reserve(max\_symbolic\_object\_size);}
\DoxyCodeLine{639         }
\DoxyCodeLine{640 \textcolor{preprocessor}{        \#pragma omp parallel}}
\DoxyCodeLine{641         \{}
\DoxyCodeLine{642             \textcolor{keyword}{auto} thread\_id = omp\_get\_thread\_num();}
\DoxyCodeLine{643 }
\DoxyCodeLine{644 \textcolor{preprocessor}{            \#pragma omp for }}
\DoxyCodeLine{645             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < truncated\_num\_object; ++i) \{}
\DoxyCodeLine{646                 \textcolor{keywordtype}{size\_t} oid = truncated\_oid[i];}
\DoxyCodeLine{647 }
\DoxyCodeLine{648                 \textcolor{comment}{/* assign parent ids and child ids for each child */}}
\DoxyCodeLine{649                 std::fill(\&symbolic\_iteration.parent\_oid[child\_begin[i]],}
\DoxyCodeLine{650                     \&symbolic\_iteration.parent\_oid[child\_begin[i + 1]],}
\DoxyCodeLine{651                     oid);}
\DoxyCodeLine{652                 std::iota(\&symbolic\_iteration.child\_id[child\_begin[i]],}
\DoxyCodeLine{653                     \&symbolic\_iteration.child\_id[child\_begin[i + 1]],}
\DoxyCodeLine{654                     0);}
\DoxyCodeLine{655             \}}
\DoxyCodeLine{656 }
\DoxyCodeLine{657 }
\DoxyCodeLine{658 }
\DoxyCodeLine{659 }
\DoxyCodeLine{660             \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{661 \textcolor{comment}{            symbolic\_iteration}}
\DoxyCodeLine{662 \textcolor{comment}{             !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{663 \textcolor{preprocessor}{            \#pragma omp single}}
\DoxyCodeLine{664             mid\_step\_function(\textcolor{stringliteral}{"{}symbolic\_iteration"{}});}
\DoxyCodeLine{665 }
\DoxyCodeLine{666 \textcolor{preprocessor}{            \#pragma omp for }}
\DoxyCodeLine{667             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < symbolic\_iteration.num\_object; ++oid) \{}
\DoxyCodeLine{668                 \textcolor{keyword}{auto} \textcolor{keywordtype}{id} = symbolic\_iteration.parent\_oid[oid];}
\DoxyCodeLine{669 }
\DoxyCodeLine{670                 \textcolor{comment}{/* generate graph */}}
\DoxyCodeLine{671                 symbolic\_iteration.magnitude[oid] = magnitude[id];}
\DoxyCodeLine{672                 rule-\/>populate\_child(\&objects[object\_begin[\textcolor{keywordtype}{id}]],}
\DoxyCodeLine{673                     \&objects[object\_begin[\textcolor{keywordtype}{id} + 1]],}
\DoxyCodeLine{674                     symbolic\_iteration.placeholder[thread\_id], symbolic\_iteration.child\_id[oid],}
\DoxyCodeLine{675                     symbolic\_iteration.size[oid], symbolic\_iteration.magnitude[oid]);}
\DoxyCodeLine{676 }
\DoxyCodeLine{677                 \textcolor{comment}{/* compute hash */}}
\DoxyCodeLine{678                 symbolic\_iteration.hash[oid] = rule-\/>hasher(symbolic\_iteration.placeholder[thread\_id],}
\DoxyCodeLine{679                     symbolic\_iteration.placeholder[thread\_id] + symbolic\_iteration.size[oid]);}
\DoxyCodeLine{680             \}}
\DoxyCodeLine{681         \}}
\DoxyCodeLine{682     \}}
\DoxyCodeLine{683 }
\DoxyCodeLine{684     \textcolor{comment}{/*}}
\DoxyCodeLine{685 \textcolor{comment}{    compute interferences}}
\DoxyCodeLine{686 \textcolor{comment}{    */}}
\DoxyCodeLine{687     \textcolor{keywordtype}{void} symbolic\_iteration::compute\_collisions(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function) \{}
\DoxyCodeLine{688         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}} == 0) \{}
\DoxyCodeLine{689             \mbox{\hyperlink{classquids_1_1symbolic__iteration_a54dda8c91c4bf8f7a097910ff4fbe34b}{num\_object\_after\_interferences}} = 0;}
\DoxyCodeLine{690             mid\_step\_function(\textcolor{stringliteral}{"{}compute\_collisions -\/ prepare"{}});}
\DoxyCodeLine{691             mid\_step\_function(\textcolor{stringliteral}{"{}compute\_collisions -\/ insert"{}});}
\DoxyCodeLine{692             mid\_step\_function(\textcolor{stringliteral}{"{}compute\_collisions -\/ finalize"{}});}
\DoxyCodeLine{693             \textcolor{keywordflow}{return};}
\DoxyCodeLine{694         \}}
\DoxyCodeLine{695 }
\DoxyCodeLine{696         \textcolor{keywordtype}{int} num\_threads;}
\DoxyCodeLine{697 \textcolor{preprocessor}{        \#pragma omp parallel}}
\DoxyCodeLine{698 \textcolor{preprocessor}{        \#pragma omp single}}
\DoxyCodeLine{699         num\_threads = omp\_get\_num\_threads();}
\DoxyCodeLine{700 }
\DoxyCodeLine{701         \textcolor{keywordtype}{int} \textcolor{keyword}{const} num\_bucket = utils::nearest\_power\_of\_two(\mbox{\hyperlink{namespacequids_a967bbc4ed348a75e24789554a64f8d62}{load\_balancing\_bucket\_per\_thread}}*num\_threads);}
\DoxyCodeLine{702         \textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} offset = 8*\textcolor{keyword}{sizeof}(size\_t) -\/ utils::log\_2\_upper\_bound(num\_bucket);}
\DoxyCodeLine{703 }
\DoxyCodeLine{704         std::vector<int> load\_balancing\_begin(num\_threads + 1, 0);}
\DoxyCodeLine{705         std::vector<size\_t> partition\_begin(num\_bucket + 1, 0);}
\DoxyCodeLine{706 }
\DoxyCodeLine{707 }
\DoxyCodeLine{708 }
\DoxyCodeLine{709 }
\DoxyCodeLine{710 }
\DoxyCodeLine{711 }
\DoxyCodeLine{712         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{713 \textcolor{comment}{        partition}}
\DoxyCodeLine{714 \textcolor{comment}{        !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{715         mid\_step\_function(\textcolor{stringliteral}{"{}compute\_collisions -\/ prepare"{}});}
\DoxyCodeLine{716         quids::utils::parallel\_generalized\_partition\_from\_iota(\&next\_oid[0], \&next\_oid[0] + \mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}}, 0,}
\DoxyCodeLine{717             \&partition\_begin[0], \&partition\_begin[num\_bucket + 1],}
\DoxyCodeLine{718             [\&](\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} oid) \{}
\DoxyCodeLine{719                 \textcolor{keywordflow}{return} hash[oid] >> offset;}
\DoxyCodeLine{720             \});}
\DoxyCodeLine{721 }
\DoxyCodeLine{722 }
\DoxyCodeLine{723 }
\DoxyCodeLine{724 }
\DoxyCodeLine{725 }
\DoxyCodeLine{726         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{727 \textcolor{comment}{        load-\/balance}}
\DoxyCodeLine{728 \textcolor{comment}{        !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{729         \mbox{\hyperlink{namespacequids_1_1utils_a26acad53fb0779fa4d590533dbf48d7b}{utils::load\_balancing\_from\_prefix\_sum}}(partition\_begin.begin(), partition\_begin.end(),}
\DoxyCodeLine{730             load\_balancing\_begin.begin(), load\_balancing\_begin.end());}
\DoxyCodeLine{731 }
\DoxyCodeLine{732 }
\DoxyCodeLine{733 }
\DoxyCodeLine{734 }
\DoxyCodeLine{735 }
\DoxyCodeLine{736 }
\DoxyCodeLine{737         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{738 \textcolor{comment}{        compute-\/collision}}
\DoxyCodeLine{739 \textcolor{comment}{        !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{740         mid\_step\_function(\textcolor{stringliteral}{"{}compute\_collisions -\/ insert"{}});}
\DoxyCodeLine{741 \textcolor{preprocessor}{        \#pragma omp parallel}}
\DoxyCodeLine{742         \{}
\DoxyCodeLine{743             \textcolor{keywordtype}{int} thread\_id = omp\_get\_thread\_num();}
\DoxyCodeLine{744             \textcolor{keywordtype}{int} load\_begin = load\_balancing\_begin[thread\_id], load\_end = load\_balancing\_begin[thread\_id + 1];}
\DoxyCodeLine{745             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = load\_begin; j < load\_end; ++j) \{}
\DoxyCodeLine{746                 robin\_hood::unordered\_map<size\_t, size\_t> elimination\_map;}
\DoxyCodeLine{747 }
\DoxyCodeLine{748                 \textcolor{keywordtype}{size\_t} begin = partition\_begin[j], end = partition\_begin[j + 1];}
\DoxyCodeLine{749 }
\DoxyCodeLine{750                 elimination\_map.reserve(end -\/ begin);}
\DoxyCodeLine{751                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = begin; i < end; ++i) \{}
\DoxyCodeLine{752                     \textcolor{keywordtype}{size\_t} oid = next\_oid[i];}
\DoxyCodeLine{753 }
\DoxyCodeLine{754                     \textcolor{comment}{/* accessing key */}}
\DoxyCodeLine{755                     \textcolor{keyword}{auto} [it, unique] = elimination\_map.insert(\{hash[oid], oid\});}
\DoxyCodeLine{756                     \textcolor{keywordflow}{if} (!unique)}
\DoxyCodeLine{757                         \textcolor{comment}{/* if it exist add the probabilities */}}
\DoxyCodeLine{758                         magnitude[it-\/>second] += magnitude[oid];}
\DoxyCodeLine{759                     \textcolor{comment}{/* keep the object if it is unique */}}
\DoxyCodeLine{760                     is\_unique[oid] = unique;}
\DoxyCodeLine{761                 \}}
\DoxyCodeLine{762             \}}
\DoxyCodeLine{763         \}}
\DoxyCodeLine{764         mid\_step\_function(\textcolor{stringliteral}{"{}compute\_collisions -\/ finalize"{}});}
\DoxyCodeLine{765 }
\DoxyCodeLine{766 }
\DoxyCodeLine{767 }
\DoxyCodeLine{768 }
\DoxyCodeLine{769 }
\DoxyCodeLine{770         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{771 \textcolor{comment}{        partition}}
\DoxyCodeLine{772 \textcolor{comment}{        !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{773         \textcolor{keywordtype}{size\_t}* partitioned\_it = \_\_gnu\_parallel::partition(\&next\_oid[0], \&next\_oid[0] + \mbox{\hyperlink{classquids_1_1symbolic__iteration_a688bb468e98b73bd13f81d7915dc3a2f}{num\_object}},}
\DoxyCodeLine{774             [\&](\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid) \{}
\DoxyCodeLine{775                 \textcolor{keywordflow}{if} (!is\_unique[oid])}
\DoxyCodeLine{776                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{777 }
\DoxyCodeLine{778                 \textcolor{keywordflow}{return} std::norm(magnitude[oid]) > \mbox{\hyperlink{namespacequids_ae6148553f287fa7c670cc8d0a729fe8d}{tolerance}};}
\DoxyCodeLine{779             \});}
\DoxyCodeLine{780         \mbox{\hyperlink{classquids_1_1symbolic__iteration_a54dda8c91c4bf8f7a097910ff4fbe34b}{num\_object\_after\_interferences}} = std::distance(\&next\_oid[0], partitioned\_it);}
\DoxyCodeLine{781     \}}
\DoxyCodeLine{782 }
\DoxyCodeLine{783     \textcolor{comment}{/*}}
\DoxyCodeLine{784 \textcolor{comment}{    prepare truncate}}
\DoxyCodeLine{785 \textcolor{comment}{    */}}
\DoxyCodeLine{786     \textcolor{keywordtype}{void} symbolic\_iteration::prepare\_truncate(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function) \{}
\DoxyCodeLine{787         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{788 \textcolor{comment}{        prepare truncate}}
\DoxyCodeLine{789 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{790 }
\DoxyCodeLine{791         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{namespacequids_af08ec7fda63cfb6d458ad3bb10b31e4d}{simple\_truncation}})}
\DoxyCodeLine{792 \textcolor{preprocessor}{            \#pragma omp parallel}}
\DoxyCodeLine{793             \{}
\DoxyCodeLine{794                 utils::random\_generator rng;}
\DoxyCodeLine{795 }
\DoxyCodeLine{796 \textcolor{preprocessor}{                \#pragma omp for}}
\DoxyCodeLine{797                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{classquids_1_1symbolic__iteration_a54dda8c91c4bf8f7a097910ff4fbe34b}{num\_object\_after\_interferences}}; ++i) \{}
\DoxyCodeLine{798                     \textcolor{keywordtype}{size\_t} oid = next\_oid[i];}
\DoxyCodeLine{799                     random\_selector[oid] = rng() / std::norm(magnitude[oid]); \textcolor{comment}{//-\/std::log(1 -\/ rng()) / std::norm(magnitude[oid]);}}
\DoxyCodeLine{800                 \}}
\DoxyCodeLine{801             \}}
\DoxyCodeLine{802     \}}
\DoxyCodeLine{803 }
\DoxyCodeLine{804     \textcolor{comment}{/*}}
\DoxyCodeLine{805 \textcolor{comment}{    get the truncated memory size}}
\DoxyCodeLine{806 \textcolor{comment}{    */}}
\DoxyCodeLine{807     \textcolor{keywordtype}{size\_t} symbolic\_iteration::get\_truncated\_mem\_size(\textcolor{keywordtype}{size\_t} begin\_num\_object)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{808         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} iteration\_memory\_size = 2*\textcolor{keyword}{sizeof}(PROBA\_TYPE) + 4*\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}) + \textcolor{keyword}{sizeof}(float);}
\DoxyCodeLine{809 }
\DoxyCodeLine{810         \textcolor{keywordtype}{size\_t} mem\_size = iteration\_memory\_size*(next\_iteration\_num\_object -\/ begin\_num\_object);}
\DoxyCodeLine{811         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = begin\_num\_object; i < next\_iteration\_num\_object; ++i)}
\DoxyCodeLine{812             mem\_size += size[next\_oid[i]];}
\DoxyCodeLine{813 }
\DoxyCodeLine{814         \textcolor{keywordflow}{return} mem\_size;}
\DoxyCodeLine{815     \}}
\DoxyCodeLine{816 }
\DoxyCodeLine{817     \textcolor{comment}{/*}}
\DoxyCodeLine{818 \textcolor{comment}{    truncate}}
\DoxyCodeLine{819 \textcolor{comment}{    */}}
\DoxyCodeLine{820     \textcolor{keywordtype}{void} symbolic\_iteration::truncate(\textcolor{keywordtype}{size\_t} begin\_num\_object, \textcolor{keywordtype}{size\_t} max\_num\_object, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function) \{}
\DoxyCodeLine{821         \textcolor{keywordflow}{if} (next\_iteration\_num\_object == 0)}
\DoxyCodeLine{822             \textcolor{keywordflow}{return};}
\DoxyCodeLine{823 }
\DoxyCodeLine{824         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{825 \textcolor{comment}{        truncate}}
\DoxyCodeLine{826 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{827 }
\DoxyCodeLine{828         \textcolor{keywordflow}{if} (max\_num\_object >= \mbox{\hyperlink{classquids_1_1symbolic__iteration_a54dda8c91c4bf8f7a097910ff4fbe34b}{num\_object\_after\_interferences}}) \{}
\DoxyCodeLine{829             next\_iteration\_num\_object = \mbox{\hyperlink{classquids_1_1symbolic__iteration_a54dda8c91c4bf8f7a097910ff4fbe34b}{num\_object\_after\_interferences}};}
\DoxyCodeLine{830             \textcolor{keywordflow}{return};}
\DoxyCodeLine{831         \}}
\DoxyCodeLine{832 }
\DoxyCodeLine{833         \textcolor{comment}{/* delimitations */}}
\DoxyCodeLine{834         \textcolor{keyword}{auto} begin = next\_oid.begin() + begin\_num\_object;}
\DoxyCodeLine{835         \textcolor{keyword}{auto} middle = next\_oid.begin() + max\_num\_object;}
\DoxyCodeLine{836         \textcolor{keyword}{auto} end = next\_oid.begin() + next\_iteration\_num\_object;}
\DoxyCodeLine{837 }
\DoxyCodeLine{838         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacequids_af08ec7fda63cfb6d458ad3bb10b31e4d}{simple\_truncation}}) \{}
\DoxyCodeLine{839             \textcolor{comment}{/* truncation */}}
\DoxyCodeLine{840             \_\_gnu\_parallel::nth\_element(begin, middle, end,}
\DoxyCodeLine{841             [\&](\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid1, \textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid2) \{}
\DoxyCodeLine{842                 \textcolor{keywordflow}{return} std::norm(magnitude[oid1]) > std::norm(magnitude[oid2]);}
\DoxyCodeLine{843             \});}
\DoxyCodeLine{844         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{845             \textcolor{comment}{/* select graphs according to random selectors */}}
\DoxyCodeLine{846             \_\_gnu\_parallel::nth\_element(begin, middle, end,}
\DoxyCodeLine{847             [\&](\textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid1, \textcolor{keywordtype}{size\_t} \textcolor{keyword}{const} \&oid2) \{}
\DoxyCodeLine{848                 \textcolor{keywordflow}{return} random\_selector[oid1] < random\_selector[oid2];}
\DoxyCodeLine{849             \});}
\DoxyCodeLine{850         \}}
\DoxyCodeLine{851 }
\DoxyCodeLine{852         }
\DoxyCodeLine{853         next\_iteration\_num\_object = max\_num\_object;}
\DoxyCodeLine{854     \}}
\DoxyCodeLine{855 }
\DoxyCodeLine{856     \textcolor{comment}{/*}}
\DoxyCodeLine{857 \textcolor{comment}{    finalize iteration}}
\DoxyCodeLine{858 \textcolor{comment}{    */}}
\DoxyCodeLine{859     \textcolor{keywordtype}{void} symbolic\_iteration::finalize(\mbox{\hyperlink{namespacequids_a62455c8f5240a575676aace3a25dfae3}{rule\_t}} \textcolor{keyword}{const} *rule, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \textcolor{keyword}{const} \&last\_iteration, \mbox{\hyperlink{namespacequids_a60a676728450b703f98f219a0ee7e5f2}{it\_t}} \&next\_iteration, \mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function) \{}
\DoxyCodeLine{860         \textcolor{keywordflow}{if} (next\_iteration\_num\_object == 0) \{}
\DoxyCodeLine{861             next\_iteration.num\_object = 0;}
\DoxyCodeLine{862             mid\_step\_function(\textcolor{stringliteral}{"{}prepare\_final"{}});}
\DoxyCodeLine{863             mid\_step\_function(\textcolor{stringliteral}{"{}final"{}});}
\DoxyCodeLine{864             \textcolor{keywordflow}{return};}
\DoxyCodeLine{865         \}}
\DoxyCodeLine{866 }
\DoxyCodeLine{867 }
\DoxyCodeLine{868         }
\DoxyCodeLine{869 }
\DoxyCodeLine{870 }
\DoxyCodeLine{871 }
\DoxyCodeLine{872 }
\DoxyCodeLine{873 }
\DoxyCodeLine{874         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{875 \textcolor{comment}{        prepare\_final}}
\DoxyCodeLine{876 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{877         mid\_step\_function(\textcolor{stringliteral}{"{}prepare\_final"{}});}
\DoxyCodeLine{878         next\_iteration.num\_object = next\_iteration\_num\_object;}
\DoxyCodeLine{879 }
\DoxyCodeLine{880         \textcolor{comment}{/* sort to make memory access more continuous */}}
\DoxyCodeLine{881         \_\_gnu\_parallel::sort(\&next\_oid[0], \&next\_oid[0] + next\_iteration.num\_object);}
\DoxyCodeLine{882 }
\DoxyCodeLine{883         \textcolor{comment}{/* resize new step variables */}}
\DoxyCodeLine{884         next\_iteration.resize(next\_iteration.num\_object);}
\DoxyCodeLine{885                 }
\DoxyCodeLine{886         \textcolor{comment}{/* prepare for partial sum */}}
\DoxyCodeLine{887 \textcolor{preprocessor}{        \#pragma omp parallel for }}
\DoxyCodeLine{888         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < next\_iteration.num\_object; ++oid) \{}
\DoxyCodeLine{889             \textcolor{keyword}{auto} \textcolor{keywordtype}{id} = next\_oid[oid];}
\DoxyCodeLine{890 }
\DoxyCodeLine{891             \textcolor{comment}{/* assign magnitude and size */}}
\DoxyCodeLine{892             next\_iteration.object\_begin[oid + 1] = size[id];}
\DoxyCodeLine{893             next\_iteration.magnitude[oid] = magnitude[id];}
\DoxyCodeLine{894         \}}
\DoxyCodeLine{895 }
\DoxyCodeLine{896         \_\_gnu\_parallel::partial\_sum(\&next\_iteration.object\_begin[1],}
\DoxyCodeLine{897             \&next\_iteration.object\_begin[1] + next\_iteration.num\_object,}
\DoxyCodeLine{898             \&next\_iteration.object\_begin[1]);}
\DoxyCodeLine{899 }
\DoxyCodeLine{900         next\_iteration.allocate(next\_iteration.object\_begin[next\_iteration.num\_object]);}
\DoxyCodeLine{901 }
\DoxyCodeLine{902         }
\DoxyCodeLine{903 }
\DoxyCodeLine{904 }
\DoxyCodeLine{905         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{906 \textcolor{comment}{        final}}
\DoxyCodeLine{907 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{908         mid\_step\_function(\textcolor{stringliteral}{"{}final"{}});}
\DoxyCodeLine{909 }
\DoxyCodeLine{910 \textcolor{preprocessor}{        \#pragma omp parallel for }}
\DoxyCodeLine{911         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < next\_iteration.num\_object; ++oid) \{}
\DoxyCodeLine{912             \textcolor{keyword}{auto} \textcolor{keywordtype}{id} = next\_oid[oid];}
\DoxyCodeLine{913             \textcolor{keyword}{auto} this\_parent\_oid = parent\_oid[id];}
\DoxyCodeLine{914                 }
\DoxyCodeLine{915             rule-\/>populate\_child\_simple(\&last\_iteration.objects[last\_iteration.object\_begin[this\_parent\_oid]],}
\DoxyCodeLine{916                 \&last\_iteration.objects[last\_iteration.object\_begin[this\_parent\_oid + 1]],}
\DoxyCodeLine{917                 \&next\_iteration.objects[next\_iteration.object\_begin[oid]],}
\DoxyCodeLine{918                 child\_id[\textcolor{keywordtype}{id}]);}
\DoxyCodeLine{919         \}}
\DoxyCodeLine{920     \}}
\DoxyCodeLine{921 }
\DoxyCodeLine{922     \textcolor{comment}{/*}}
\DoxyCodeLine{923 \textcolor{comment}{    apply modifier}}
\DoxyCodeLine{924 \textcolor{comment}{    */}}
\DoxyCodeLine{925     \textcolor{keywordtype}{void} iteration::apply\_modifier(\mbox{\hyperlink{namespacequids_afeaf790d80dab43e9208b19dd4a38677}{modifier\_t}} \textcolor{keyword}{const} rule) \{}
\DoxyCodeLine{926 \textcolor{preprocessor}{        \#pragma omp parallel for }}
\DoxyCodeLine{927         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}; ++oid)}
\DoxyCodeLine{928             \textcolor{comment}{/* generate graph */}}
\DoxyCodeLine{929             rule(\&objects[object\_begin[oid]],}
\DoxyCodeLine{930                 \&objects[object\_begin[oid + 1]],}
\DoxyCodeLine{931                 magnitude[oid]);}
\DoxyCodeLine{932     \}}
\DoxyCodeLine{933 }
\DoxyCodeLine{934     \textcolor{comment}{/*}}
\DoxyCodeLine{935 \textcolor{comment}{    normalize}}
\DoxyCodeLine{936 \textcolor{comment}{    */}}
\DoxyCodeLine{937     \textcolor{keywordtype}{void} iteration::normalize(\mbox{\hyperlink{namespacequids_a42e549faf01dce4f7e39af6770c1a780}{debug\_t}} mid\_step\_function) \{}
\DoxyCodeLine{938         \mbox{\hyperlink{classquids_1_1iteration_ad330de0af20f855358d13da0cf55d014}{total\_proba}} = 0;}
\DoxyCodeLine{939 }
\DoxyCodeLine{940         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}} == 0) \{}
\DoxyCodeLine{941             mid\_step\_function(\textcolor{stringliteral}{"{}normalize"{}});}
\DoxyCodeLine{942             mid\_step\_function(\textcolor{stringliteral}{"{}end"{}});}
\DoxyCodeLine{943             \textcolor{keywordflow}{return};}
\DoxyCodeLine{944         \}}
\DoxyCodeLine{945 }
\DoxyCodeLine{946 }
\DoxyCodeLine{947 }
\DoxyCodeLine{948 }
\DoxyCodeLine{949         \textcolor{comment}{/* !!!!!!!!!!!!!!!!}}
\DoxyCodeLine{950 \textcolor{comment}{        normalize}}
\DoxyCodeLine{951 \textcolor{comment}{         !!!!!!!!!!!!!!!! */}}
\DoxyCodeLine{952         mid\_step\_function(\textcolor{stringliteral}{"{}normalize"{}});}
\DoxyCodeLine{953 }
\DoxyCodeLine{954 \textcolor{preprocessor}{        \#pragma omp parallel}}
\DoxyCodeLine{955         \{}
\DoxyCodeLine{956 \textcolor{preprocessor}{            \#pragma omp for reduction(+:total\_proba)}}
\DoxyCodeLine{957             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}; ++oid)}
\DoxyCodeLine{958                 \mbox{\hyperlink{classquids_1_1iteration_ad330de0af20f855358d13da0cf55d014}{total\_proba}} += std::norm(magnitude[oid]);}
\DoxyCodeLine{959 }
\DoxyCodeLine{960             PROBA\_TYPE normalization\_factor = std::sqrt(\mbox{\hyperlink{classquids_1_1iteration_ad330de0af20f855358d13da0cf55d014}{total\_proba}});}
\DoxyCodeLine{961 }
\DoxyCodeLine{962             \textcolor{keywordflow}{if} (normalization\_factor != 1)}
\DoxyCodeLine{963 \textcolor{preprocessor}{                \#pragma omp for}}
\DoxyCodeLine{964                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} oid = 0; oid < \mbox{\hyperlink{classquids_1_1iteration_ada9a7c0e3d1ab4624e618154f02e0769}{num\_object}}; ++oid)}
\DoxyCodeLine{965                     magnitude[oid] /= normalization\_factor;}
\DoxyCodeLine{966         \}}
\DoxyCodeLine{967         }
\DoxyCodeLine{968         mid\_step\_function(\textcolor{stringliteral}{"{}end"{}});}
\DoxyCodeLine{969     \}}
\DoxyCodeLine{970 \}}

\end{DoxyCode}
